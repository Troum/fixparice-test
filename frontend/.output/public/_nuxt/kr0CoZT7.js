import{e as E,l as F,f as L,m as G,n as x,v as H,A as J,p as O,c as k,a,s as $,b as u,i as s,t as p,w,o as b,x as C,B as o,q as Q,j as W,d as X}from"./DwR0AEf0.js";import{_ as Y,a as Z,b as ee,c as te}from"./DfBD7kbV.js";import{_ as ae}from"./BiHkM03E.js";import{_ as se}from"./COr5thys.js";import{u as oe}from"./Yc1AK7If.js";import{u as re}from"./st4SvOgC.js";import"./Cz8f_uTG.js";import"./Do5xAnQH.js";const ie={class:"min-w-screen min-h-screen p-4"},le={class:"mb-6 flex justify-between items-center"},ne={key:0,class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ce={class:"bg-card rounded-lg p-4 border"},de={class:"text-2xl font-bold text-primary"},ue={class:"bg-card rounded-lg p-4 border"},me={class:"text-2xl font-bold text-success"},ge={class:"bg-card rounded-lg p-4 border"},pe={class:"text-2xl font-bold text-warning"},fe={class:"bg-card rounded-lg p-4 border"},_e={class:"text-2xl font-bold text-info"},ve={class:"flex justify-between items-center"},xe={class:"mb-4 flex gap-3 items-center"},we={class:"flex justify-center mt-4"},be=10,je=E({__name:"index",setup(he){const h=F(),m=L(),c=G(),{usePaginatedData:U,getVacanciesStats:I,deleteVacancy:j,updateVacancy:D}=H(),{confirm:y}=oe(),{canCreateVacancies:B,canUpdateVacancies:V,canDeleteVacancies:K,canViewStats:S}=re(),d=W,N=te,i=x(Number(h.query.page??1)),l=x(String(h.query.sort??"-created_at")),{pending:R,fetchData:q,items:A,meta:f}=U("vacancies",!0),_=async()=>{await q({page:i.value,perPage:be,sort:l.value,expand:"created_at,updated_at"})};J([i,l],()=>{_(),m.replace({query:{page:i.value,sort:l.value}})},{immediate:!0});const P=[{accessorKey:"id",header:"ID",cell:({row:t})=>`#${t.getValue("id")}`},{accessorKey:"title",header:({column:t})=>{const e=t.getIsSorted();return o(d,{color:"neutral",variant:"ghost",label:"Название",icon:e?e==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc")})},cell:({row:t})=>o("div",{class:"font-medium"},t.getValue("title"))},{accessorKey:"salary",header:({column:t})=>{const e=t.getIsSorted();return o(d,{color:"neutral",variant:"ghost",label:"Зарплата",icon:e?e==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc")})},cell:({row:t})=>{const e=t.getValue("salary");return o("div",{class:"font-medium text-green-600"},e?`${new Intl.NumberFormat("ru-RU").format(e)} ₽`:"Не указана")}},{accessorKey:"description",header:"Описание",cell:({row:t})=>{const e=t.getValue("description");return o("div",{class:"text-sm text-gray-600 max-w-xs truncate"},e||"Описание отсутствует")}},{accessorKey:"status",header:"Статус",cell:({row:t})=>{const r=t.getValue("status")===1;return o("div",{class:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${r?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},r?"Активная":"Архивная")}},{accessorKey:"created_at",header:({column:t})=>{const e=t.getIsSorted();return o(d,{color:"neutral",variant:"ghost",label:"Дата создания",icon:e?e==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc")})},cell:({row:t})=>{const e=t.getValue("created_at");return o("div",{class:"text-sm"},e?new Date(e*1e3).toLocaleDateString("ru-RU"):"-")}},{id:"actions",cell:({row:t})=>{const e=[];e.push([{label:"Просмотреть",icon:"i-lucide-eye",click:()=>m.push(`/jobs/${t.getValue("id")}`)}]),V.value&&e.push([{label:"Редактировать",icon:"i-lucide-edit",click:()=>m.push(`/jobs/${t.getValue("id")}/edit`)}]);const r=[];return V.value&&r.push({label:"Архивировать",icon:"i-lucide-archive",click:()=>{y("Архивирование вакансии",`Вы уверены, что хотите архивировать вакансию "${t.getValue("title")}"?`,"Архивировать",async()=>{try{await D(t.getValue("id"),{...t.original,status:0}),c.add({title:"Архивировано",description:"Вакансия архивирована",color:"success"}),await _()}catch{c.add({title:"Ошибка",description:"Не удалось архивировать",color:"error"})}})}}),K.value&&r.push({label:"Удалить",icon:"i-lucide-trash",click:()=>{y("Удаление вакансии",`Вы уверены, что хотите удалить вакансию "${t.getValue("title")}"? Это действие нельзя отменить.`,"Удалить",async()=>{try{await j(t.getValue("id")),c.add({title:"Удалено",description:"Вакансия удалена",color:"success"}),await _()}catch{c.add({title:"Ошибка",description:"Не удалось удалить",color:"error"})}})}}),r.length>0&&e.push(r),o("div",{class:"flex justify-end"},[o(N,{items:e},{default:()=>o(d,{icon:"i-lucide-more-horizontal",variant:"ghost",size:"sm"})})])}}],n=x({total:0,active:0,archived:0,this_month:0});return O(async()=>{if(S.value)try{const t=await I();n.value=t.data||t}catch(t){t?.status!==403&&c.add({title:"Ошибка",description:"Не удалось получить статистику",color:"error"})}}),(t,e)=>{const r=Y,v=ae,T=Z,z=ee,M=se;return b(),k("div",ie,[a("div",le,[e[3]||(e[3]=a("h1",{class:"text-2xl font-bold"},"Управление вакансиями",-1)),u(r)]),s(n)&&s(S)?(b(),k("div",ne,[a("div",ce,[a("div",de,p(s(n).total||0),1),e[4]||(e[4]=a("div",{class:"text-sm text-muted"},"Всего вакансий",-1))]),a("div",ue,[a("div",me,p(s(n).active||0),1),e[5]||(e[5]=a("div",{class:"text-sm text-muted"},"Активные",-1))]),a("div",ge,[a("div",pe,p(s(n).archived||0),1),e[6]||(e[6]=a("div",{class:"text-sm text-muted"},"Архивированные",-1))]),a("div",fe,[a("div",_e,p(s(n).this_month||0),1),e[7]||(e[7]=a("div",{class:"text-sm text-muted"},"За этот месяц",-1))])])):$("",!0),u(M,{class:"overflow-x-auto shadow-lg rounded-lg border",title:"Список вакансий"},{header:w(()=>[a("div",ve,[e[9]||(e[9]=a("h3",{class:"text-lg font-semibold"},"Список вакансий",-1)),s(B)?(b(),Q(s(d),{key:0,icon:"i-lucide-plus",onClick:e[0]||(e[0]=g=>s(m).push("/jobs/create"))},{default:w(()=>[...e[8]||(e[8]=[X(" Создать вакансию ",-1)])]),_:1})):$("",!0)])]),default:w(()=>[a("div",xe,[u(v,{modelValue:s(l),"onUpdate:modelValue":e[1]||(e[1]=g=>C(l)?l.value=g:null),class:"w-32",items:[{label:"Зарплата ↑",value:"salary"},{label:"Зарплата ↓",value:"-salary"},{label:"Дата ↑",value:"created_at"},{label:"Дата ↓",value:"-created_at"}]},null,8,["modelValue"])]),u(T,{data:s(A),columns:P,loading:s(R)},null,8,["data","loading"]),a("div",we,[u(z,{modelValue:s(i),"onUpdate:modelValue":e[2]||(e[2]=g=>C(i)?i.value=g:null),total:s(f).totalCount||0,"page-count":s(f).pageCount||1,"per-page":s(f).perPage||10,"show-links":""},null,8,["modelValue","total","page-count","per-page"])])]),_:1})])}}});export{je as default};
