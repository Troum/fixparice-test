import{e as F,l as H,f as L,m as G,n as v,v as J,A as O,p as Q,u as W,c as $,q as k,s as b,a,b as m,i as s,t as p,w as y,o as _,x as C,B as o,j as X,d as Y}from"./DwR0AEf0.js";import{_ as Z,a as ee,b as te,c as ae}from"./DfBD7kbV.js";import{_ as se}from"./C9Q6IWo4.js";import{_ as oe}from"./BiHkM03E.js";import{_ as ie}from"./COr5thys.js";import{u as le}from"./Yc1AK7If.js";import{u as re}from"./De67kLFm.js";import{u as ne}from"./st4SvOgC.js";import"./Cz8f_uTG.js";import"./Do5xAnQH.js";const ce={class:"min-w-screen min-h-screen p-4"},de={class:"mb-6 flex justify-between items-center"},ue={key:1,class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},me={class:"bg-card rounded-lg p-4 border"},ge={class:"text-2xl font-bold text-primary"},pe={class:"bg-card rounded-lg p-4 border"},_e={class:"text-2xl font-bold text-success"},fe={class:"bg-card rounded-lg p-4 border"},xe={class:"text-2xl font-bold text-warning"},ve={class:"bg-card rounded-lg p-4 border"},be={class:"text-2xl font-bold text-info"},ye={class:"flex justify-between items-center"},we={class:"mb-4 flex gap-3 items-center"},he={class:"flex justify-center mt-4"},Ve=10,je=F({__name:"index",setup(Se){const w=H(),d=L(),i=G(),{usePaginatedData:U,getVacanciesStats:h,deleteVacancy:D,updateVacancy:I}=J(),{confirm:V}=le(),{isDemoUser:S,getDemoNotification:N}=re(),{canCreateVacancies:B}=ne(),u=X,K=ae,l=v(Number(w.query.page??1)),r=v(String(w.query.sort??"-created_at")),{pending:R,fetchData:j,items:q,meta:f}=U("vacancies",!0),x=async()=>{await j({page:l.value,perPage:Ve,sort:r.value,expand:"created_at,updated_at"})};O([l,r],()=>{x(),d.replace({query:{page:l.value,sort:r.value}})},{immediate:!0});const A=[{accessorKey:"id",header:"ID",cell:({row:e})=>`#${e.getValue("id")}`},{accessorKey:"title",header:({column:e})=>{const t=e.getIsSorted();return o(u,{color:"neutral",variant:"ghost",label:"Название",icon:t?t==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>o("div",{class:"font-medium"},e.getValue("title"))},{accessorKey:"salary",header:({column:e})=>{const t=e.getIsSorted();return o(u,{color:"neutral",variant:"ghost",label:"Зарплата",icon:t?t==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>{const t=e.getValue("salary");return o("div",{class:"font-medium text-green-600"},t?`${new Intl.NumberFormat("ru-RU").format(t)} ₽`:"Не указана")}},{accessorKey:"description",header:"Описание",cell:({row:e})=>{const t=e.getValue("description");return o("div",{class:"text-sm text-gray-600 max-w-xs truncate"},t||"Описание отсутствует")}},{accessorKey:"status",header:"Статус",cell:({row:e})=>{const c=e.getValue("status")===1;return o("div",{class:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${c?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},c?"Активная":"Архивная")}},{accessorKey:"created_at",header:({column:e})=>{const t=e.getIsSorted();return o(u,{color:"neutral",variant:"ghost",label:"Дата создания",icon:t?t==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>{const t=e.getValue("created_at");return o("div",{class:"text-sm"},t?new Date(t*1e3).toLocaleDateString("ru-RU"):"-")}},{id:"actions",cell:({row:e})=>{const t=[[{label:"Просмотреть",icon:"i-lucide-eye",onClick:()=>d.push(`/demo/${e.getValue("id")}`)}],[{label:"Редактировать",icon:"i-lucide-edit",onClick:()=>d.push(`/demo/edit/${e.getValue("id")}`)}],[{label:e.getValue("status")?"Архивировать":"Разархивировать",icon:"i-lucide-archive",onClick:()=>{V("Архивирование вакансии",`Вы уверены, что хотите ${e.getValue("status")?"архивировать":"разархивировать"} вакансию "${e.getValue("title")}"?`,e.getValue("status")?"Архивировать":"Разархивировать",async()=>{try{await I(e.getValue("id"),{...e.original,status:e.getValue("status")?0:1}),await x().then(()=>{i.add({title:e.getValue("status")?"Разархивировано":"Архивировано",description:`Вакансия ${e.getValue("id")?"разархивирована":"заархивирована"}`,color:"success"})}).then(async()=>{await h()})}catch{i.add({title:"Ошибка",description:"Не удалось архивировать",color:"error"})}})}},{label:"Удалить",icon:"i-lucide-trash",click:()=>{V("Удаление вакансии",`Вы уверены, что хотите удалить вакансию "${e.getValue("title")}"? Это действие нельзя отменить.`,"Удалить",async()=>{try{await D(e.getValue("id")),i.add({title:"Удалено",description:"Вакансия удалена",color:"success"}),await x()}catch{i.add({title:"Ошибка",description:"Не удалось удалить",color:"error"})}})}}]];return o("div",{class:"flex justify-end"},[o(K,{items:t},{default:()=>o(u,{icon:"i-lucide-more-horizontal",variant:"ghost",size:"sm"})})])}}],n=v({total:0,active:0,archived:0,this_month:0});return Q(async()=>{try{const e=await h();n.value=e.data||e}catch{i.add({title:"Ошибка",description:"Не удалось получить статистику",color:"error"})}if(S.value){const e=N();i.add(e)}}),W({title:"Демо - Управление вакансиями"}),(e,t)=>{const c=se,P=Z,T=oe,z=ee,M=te,E=ie;return _(),$("div",ce,[s(S)?(_(),k(c,{key:0,icon:"i-lucide-info",color:"info",variant:"subtle",title:"Демо режим активен",description:"Вы используете демо версию с правами менеджера. Все функции доступны для тестирования. Данные являются тестовыми.",class:"mb-6",actions:[{label:"Войти под своим аккаунтом",click:()=>s(d).push("/login")}]},null,8,["actions"])):b("",!0),a("div",de,[t[3]||(t[3]=a("h1",{class:"text-2xl font-bold"},"Демо - Управление вакансиями",-1)),m(P)]),s(n)?(_(),$("div",ue,[a("div",me,[a("div",ge,p(s(n).total||0),1),t[4]||(t[4]=a("div",{class:"text-sm text-muted"},"Всего вакансий",-1))]),a("div",pe,[a("div",_e,p(s(n).active||0),1),t[5]||(t[5]=a("div",{class:"text-sm text-muted"},"Активные",-1))]),a("div",fe,[a("div",xe,p(s(n).archived||0),1),t[6]||(t[6]=a("div",{class:"text-sm text-muted"},"Архивированные",-1))]),a("div",ve,[a("div",be,p(s(n).this_month||0),1),t[7]||(t[7]=a("div",{class:"text-sm text-muted"},"За этот месяц",-1))])])):b("",!0),m(E,{class:"overflow-x-auto shadow-lg rounded-lg border",title:"Список вакансий"},{header:y(()=>[a("div",ye,[t[9]||(t[9]=a("h3",{class:"text-lg font-semibold"},"Список вакансий",-1)),s(B)?(_(),k(s(u),{key:0,icon:"i-lucide-plus",onClick:t[0]||(t[0]=g=>s(d).push("/demo/create"))},{default:y(()=>[...t[8]||(t[8]=[Y(" Создать демо вакансию ",-1)])]),_:1})):b("",!0)])]),default:y(()=>[a("div",we,[m(T,{modelValue:s(r),"onUpdate:modelValue":t[1]||(t[1]=g=>C(r)?r.value=g:null),class:"w-32",items:[{label:"Зарплата ↑",value:"salary"},{label:"Зарплата ↓",value:"-salary"},{label:"Дата ↑",value:"created_at"},{label:"Дата ↓",value:"-created_at"}]},null,8,["modelValue"])]),m(z,{data:s(q),columns:A,loading:s(R)},null,8,["data","loading"]),a("div",he,[m(M,{modelValue:s(l),"onUpdate:modelValue":t[2]||(t[2]=g=>C(l)?l.value=g:null),total:s(f).totalCount||0,"page-count":s(f).pageCount||1,"per-page":s(f).perPage||10,"show-links":""},null,8,["modelValue","total","page-count","per-page"])])]),_:1})])}}});export{je as default};
